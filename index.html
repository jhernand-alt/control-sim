<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title data-lang-key="document_title">An√°lisis de Sistemas de Primer y Segundo Orden</title>
    
    <link rel="stylesheet" href="styles.css"> 

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
</head>
<body>

    <main class="container"> 
        
        <div id="language-selector-container">
            <select id="languageSelector" class="lang-selector" onchange="setLanguage(this.value)">
                <option value="es">ES (Espa√±ol)</option>
                <option value="en">EN (English)</option>
            </select>
        </div>
        
        <header>
            <h1 data-lang-key="title_main">‚öôÔ∏è Respuesta Temporal de Sistemas de Primer y Segundo Orden</h1>
        </header>

        <div class="controls-and-filters" role="region" aria-label="Par√°metros y Tipo de Simulaci√≥n">
            
            <div class="top-row-grid"> 
                
                <div class="parameter-group">
                    <h3 data-lang-key="config_title">Configuraci√≥n de la Simulaci√≥n</h3>
                    
                    <label class="selector-label" for="loopSelector" data-lang-key="loop_type_label">Tipo de Lazo:</label>
                    <select id="loopSelector" class="chart-selector" onchange="toggleControllerInputs(); updateDiagram()">
                        <option value="open" data-lang-key="loop_open">Lazo Abierto</option>
                        <option value="closed" data-lang-key="loop_closed">Lazo Cerrado (Controlador PID)</option>
                    </select>

                    <label class="selector-label" for="inputSelector" data-lang-key="input_type_label">Tipo de Entrada $R(s)$:</label>
                    <select id="inputSelector" class="chart-selector" onchange="toggleInputParams()">
                        <option value="step" data-lang-key="input_step">Escal√≥n (Step)</option>
                        <option value="ramp" data-lang-key="input_ramp">Rampa</option>
                        <option value="sinusoidal" data-lang-key="input_sin">Senoidal (Seno)</option>
                    </select>
                    
                    <hr>
                    
                    <h4 data-lang-key="input_params_title">Par√°metros de la Entrada</h4>
                    <div id="inputParamsContainer">
                        </div>
                    
                    <div id="controllerParamsWrapper">
                        <hr>
                        <h4 data-lang-key="controller_title">Controlador **PID** ($G_c(s)$)</h4>
                        
                        <label class="selector-label" for="paramKc" data-lang-key="kc_label">Ganancia Control ($K_c$) [0.1, 100]:</label>
                        <input type="number" id="paramKc" class="input-param" value="1.0" step="0.1" min="0.1" max="100.0" onchange="updateFTFromInputs()">

                        <div id="TiContainer">
                            <label class="selector-label" for="paramTi" data-lang-key="ti_label">Tiempo Integral ($T_i$) [0.001, $\approx \infty$]:</label>
                            <input type="number" id="paramTi" class="input-param" value="999999.0" step="0.5" min="0.001" max="999999.0" onchange="updateFTFromInputs()">
                        </div>
                        
                        <div id="TdContainer_c"> 
                            <label class="selector-label" for="paramTd_c" data-lang-key="tdc_label">Tiempo Derivativo ($T_{d,c}$) [0.0, 100]:</label>
                            <input type="number" id="paramTd_c" class="input-param" value="0.0" step="0.1" min="0.0" max="100.0" onchange="updateFTFromInputs()">
                        </div>
                    </div>
                </div>
                
                <div class="system-params-ft-group">
                    
                    <div class="parameter-group">
                        <h3 data-lang-key="system_params_title">Par√°metros del Sistema ($G_p(s)$)</h3>
                        
                        <label class="selector-label" for="systemOrderSelector" data-lang-key="system_order_label">Orden del Sistema:</label>
                        <select id="systemOrderSelector" class="chart-selector" onchange="toggleSystemParams(); updateFTFromInputs()">
                            <option value="first" data-lang-key="order_first">Primer Orden (FO)</option>
                            <option value="second" data-lang-key="order_second">Segundo Orden (SO)</option>
                        </select>
                        
                        <label class="selector-label" for="paramKp" data-lang-key="kp_label">Ganancia ($K_p$) [0.1, 10]:</label>
                        <input type="number" id="paramKp" class="input-param" value="1.0" step="0.1" min="0.1" max="10.0" onchange="updateFTFromInputs()">

                        <div id="firstOrderParams">
                            <label class="selector-label" for="paramTau" data-lang-key="tau_label">Constante de Tiempo ($\tau$) [0.1, 100]:</label>
                            <input type="number" id="paramTau" class="input-param" value="5.0" step="0.5" min="0.1" max="100.0" onchange="updateFTFromInputs()">
                        </div>

                        <div id="secondOrderParams" style="display:none;">
                            <label class="selector-label" for="paramWn" data-lang-key="wn_label">Frecuencia Natural ($\omega_n$) [0.1, 10]:</label>
                            <input type="number" id="paramWn" class="input-param" value="1.0" step="0.1" min="0.1" max="10.0" onchange="updateFTFromInputs()">
                            
                            <label class="selector-label" for="paramZeta" data-lang-key="zeta_label">Factor de Amort. ($\zeta$) [-5, 5]:</label>
                            <input type="number" id="paramZeta" class="input-param" value="0.7" step="0.1" min="-5.0" max="5.0" onchange="updateFTFromInputs()">
                        </div>

                        <label class="selector-label" for="paramTd" id="paramTdLabel" data-lang-key="td_label">Tiempo Muerto F√≠sico ($T_d$) [0.0, 20]:</label>
                        <input type="number" id="paramTd" class="input-param" value="0.0" step="0.5" min="0" max="20.0" onchange="updateFTFromInputs()" title="Este Td afecta al retardo de la respuesta.">
                        
                    </div>
                    
                    <section class="ft-container" aria-labelledby="ftHeader">
                        <h2 id="ftHeader" data-lang-key="ft_diagram_title">Funci√≥n de Transferencia y Diagrama</h2>
                        <div class="ft-display" id="ftDisplay">
                            </div>
                        
                        <div id="diagramBlock" class="diagram-container">
                             </div>
                    </section>
                </div>
                
            </div> <div id="buttonRow" class="button-row">
                <button id="addButton" onclick="addSimulationLine()" class="action-button primary-button" data-lang-key="button_simulate">‚ûï Simular y A√±adir L√≠nea</button>
                
                <button id="downloadImageButton" onclick="downloadChartAsImage()" class="action-button download-button" data-lang-key="button_download_image">üñºÔ∏è Descargar Gr√°fica (PNG)</button>
                <button id="downloadDataButton" onclick="downloadChartDataAsCSV()" class="action-button download-button" data-lang-key="button_download_data">üìä Descargar Datos (CSV)</button>

                <button id="clearResponsesButton" onclick="clearResponses()" class="action-button secondary-button" style="background-color: #f97316;" data-lang-key="button_clear_responses">üóëÔ∏è Borrar Salidas Y(t)</button>
                <button id="clearAllButton" onclick="clearAllLines()" class="action-button secondary-button" data-lang-key="button_clear_all">üóëÔ∏è Borrar Todo</button>
            </div>
            
        </div>

        <section aria-labelledby="graficoHeader">
            <h2 id="graficoHeader" data-lang-key="chart_title">Respuesta Temporal del Sistema $Y(t)$</h2>
            <figure class="chart-container" role="img" aria-label="Gr√°fico de l√≠nea comparando la entrada R(t) con la respuesta del sistema Y(t)">
                <canvas id="responseChart"></canvas>
            </figure>
        </section>
        
        <div class="credit-text-main" data-lang-key="credit">
            </div>

    </main>
    
    <script src="lang/es.js"></script>
    <script src="lang/en.js"></script>

    <script src="script.js"></script>

</body>
</html>